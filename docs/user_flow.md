# User Flow (사용자 흐름도)
## C-Level AI Agent Service - User Journey Visualization

**버전**: v1.0  
**작성일**: 2026-01-10  
**프로젝트**: CEO를 위한 맞춤형 AI 에이전트 서비스

---

## 1. 전체 사용자 흐름 개요

본 문서는 CEO가 질의를 입력한 시점부터 에이전트가 응답을 제공하기까지의 전체 여정을 시각화합니다. 각 흐름은 PRD의 사용자 스토리와 연결되어 있습니다.

---

## 2. 핵심 사용자 흐름

### 2.1 메인 플로우: CEO 질의 → 에이전트 응답

```mermaid
graph TD
    A[CEO 로그인] --> B{인증 성공?}
    B -->|실패| C[에러 메시지 표시]
    C --> A
    B -->|성공| D[대시보드 진입]
    
    D --> E[질의 입력]
    E --> F[질의 분석 엔진]
    
    F --> G{질의 유형 판단}
    
    G -->|단일 도메인| H[단일 에이전트 호출]
    G -->|복합 도메인| I[멀티 에이전트 협업]
    G -->|불명확| J[명확화 질문 생성]
    
    J --> K[CEO에게 선택지 제시]
    K --> E
    
    H --> L[CFO/CTO/CMO/COO/CHRO 에이전트]
    I --> M[에이전트 오케스트레이터]
    
    M --> N[병렬 에이전트 호출]
    N --> O[응답 통합 및 우선순위 결정]
    
    L --> P[응답 생성]
    O --> P
    
    P --> Q{추가 질문 필요?}
    Q -->|예| R[후속 질문 제안]
    Q -->|아니오| S[최종 응답 표시]
    
    R --> E
    S --> T[보고서 저장 옵션]
    
    T --> U{보고서 저장?}
    U -->|예| V[보고서 DB 저장]
    U -->|아니오| W[대화 종료]
    
    V --> X[알림 발송]
    X --> W
    
    W --> Y[피드백 수집]
    Y --> Z[세션 종료]
    
    style A fill:#e1f5ff
    style D fill:#e1f5ff
    style S fill:#c8e6c9
    style Z fill:#ffcdd2
```

### 2.2 세부 플로우 1: 질의 분석 및 라우팅 (FEAT-1)

```mermaid
graph TD
    A[질의 텍스트 수신] --> B[전처리 및 정규화]
    B --> C[LLM 기반 의도 분석]
    
    C --> D{도메인 분류}
    
    D -->|재무 관련| E[CFO 에이전트 라우팅]
    D -->|기술 관련| F[CTO 에이전트 라우팅]
    D -->|마케팅 관련| G[CMO 에이전트 라우팅]
    D -->|운영 관련| H[COO 에이전트 라우팅]
    D -->|인사 관련| I[CHRO 에이전트 라우팅]
    D -->|복합 도메인| J[멀티 에이전트 선택]
    
    E --> K[신뢰도 스코어 계산]
    F --> K
    G --> K
    H --> K
    I --> K
    J --> L[에이전트 우선순위 결정]
    
    K --> M{신뢰도 > 80%?}
    M -->|예| N[에이전트 호출]
    M -->|아니오| O[명확화 질문 생성]
    
    L --> N
    O --> P[CEO에게 선택지 제시]
    
    style A fill:#fff9c4
    style N fill:#c8e6c9
    style O fill:#ffccbc
```

### 2.3 세부 플로우 2: 멀티 에이전트 협업 (FEAT-2)

```mermaid
graph TD
    A[멀티 에이전트 요청] --> B[에이전트 오케스트레이터]
    
    B --> C[에이전트 선택 및 순서 결정]
    C --> D{협업 모드 선택}
    
    D -->|병렬 실행| E[동시 호출]
    D -->|순차 실행| F[순차 호출]
    
    E --> G1[CFO 에이전트]
    E --> G2[CTO 에이전트]
    E --> G3[CMO 에이전트]
    
    F --> H1[1차 에이전트 호출]
    H1 --> H2[결과를 2차 에이전트에 전달]
    H2 --> H3[2차 에이전트 호출]
    
    G1 --> I[응답 수집]
    G2 --> I
    G3 --> I
    H3 --> I
    
    I --> J[응답 통합 로직]
    J --> K[중복 제거]
    K --> L[우선순위 정렬]
    L --> M[일관성 검증]
    
    M --> N{충돌 발견?}
    N -->|예| O[충돌 해결 로직]
    N -->|아니오| P[통합 응답 생성]
    
    O --> P
    P --> Q[CEO에게 전달]
    
    style A fill:#fff9c4
    style Q fill:#c8e6c9
    style O fill:#ffccbc
```

### 2.4 세부 플로우 3: 보고서 생성 및 저장 (FEAT-3)

```mermaid
graph TD
    A[보고서 생성 요청] --> B{보고서 유형 선택}
    
    B -->|요약 보고서| C[핵심 인사이트 추출]
    B -->|상세 보고서| D[전체 분석 데이터 수집]
    B -->|비교 보고서| E[시계열 데이터 조회]
    
    C --> F[보고서 템플릿 선택]
    D --> F
    E --> F
    
    F --> G[데이터 시각화]
    G --> H[차트 및 그래프 생성]
    H --> I[텍스트 요약 생성]
    
    I --> J[보고서 미리보기]
    J --> K{CEO 승인?}
    
    K -->|수정 요청| L[수정 사항 반영]
    L --> J
    
    K -->|승인| M[보고서 저장]
    M --> N[PDF/Excel 내보내기]
    
    N --> O{공유 필요?}
    O -->|예| P[공유 대상 선택]
    O -->|아니오| Q[저장 완료]
    
    P --> R[이메일/슬랙 알림 발송]
    R --> Q
    
    Q --> S[보고서 라이브러리에 추가]
    
    style A fill:#fff9c4
    style S fill:#c8e6c9
    style L fill:#ffccbc
```

### 2.5 세부 플로우 4: 실시간 알림 및 모니터링 (FEAT-4)

```mermaid
graph TD
    A[시스템 모니터링 시작] --> B[이벤트 리스너 활성화]
    
    B --> C{이벤트 발생}
    
    C -->|재무 임계값 초과| D[CFO 에이전트 알림 생성]
    C -->|시스템 장애| E[CTO 에이전트 알림 생성]
    C -->|마케팅 성과 변화| F[CMO 에이전트 알림 생성]
    C -->|운영 지표 이상| G[COO 에이전트 알림 생성]
    C -->|인사 이슈| H[CHRO 에이전트 알림 생성]
    
    D --> I[알림 우선순위 결정]
    E --> I
    F --> I
    G --> I
    H --> I
    
    I --> J{긴급도 판단}
    
    J -->|긴급| K[즉시 푸시 알림]
    J -->|중요| L[이메일 알림]
    J -->|일반| M[대시보드 알림]
    
    K --> N[CEO 확인]
    L --> N
    M --> N
    
    N --> O{조치 필요?}
    O -->|예| P[관련 에이전트 호출]
    O -->|아니오| Q[알림 기록]
    
    P --> R[조치 결과 피드백]
    R --> Q
    
    Q --> S[알림 히스토리 저장]
    
    style A fill:#fff9c4
    style K fill:#ff8a80
    style S fill:#c8e6c9
```

### 2.6 세부 플로우 5: 대화 컨텍스트 유지 (FEAT-5)

```mermaid
graph TD
    A[대화 세션 시작] --> B[세션 ID 생성]
    B --> C[컨텍스트 저장소 초기화]
    
    C --> D[CEO 질의 1]
    D --> E[질의 분석 및 응답]
    E --> F[대화 히스토리 저장]
    
    F --> G[CEO 질의 2]
    G --> H[이전 컨텍스트 조회]
    H --> I{참조 표현 감지}
    
    I -->|예| J[컨텍스트 기반 해석]
    I -->|아니오| K[독립적 질의 처리]
    
    J --> L[에이전트 호출]
    K --> L
    
    L --> M[응답 생성]
    M --> N[컨텍스트 업데이트]
    
    N --> O{대화 계속?}
    O -->|예| G
    O -->|아니오| P[세션 종료]
    
    P --> Q[최종 컨텍스트 저장]
    Q --> R[세션 요약 생성]
    
    R --> S{장기 기억 저장?}
    S -->|예| T[지식 베이스 업데이트]
    S -->|아니오| U[세션 종료]
    
    T --> U
    
    style A fill:#fff9c4
    style U fill:#c8e6c9
    style T fill:#b2dfdb
```

---

## 3. 에러 처리 플로우

### 3.1 에러 처리 및 복구

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형 판단}
    
    B -->|인증 에러| C[재로그인 요청]
    B -->|네트워크 에러| D[재시도 로직]
    B -->|LLM API 에러| E[폴백 Provider 시도]
    B -->|데이터베이스 에러| F[캐시 데이터 사용]
    B -->|비즈니스 로직 에러| G[에러 메시지 생성]
    
    C --> H[사용자에게 안내]
    D --> I{재시도 성공?}
    E --> I
    F --> I
    G --> H
    
    I -->|성공| J[정상 플로우 복귀]
    I -->|실패| K[관리자 알림]
    
    K --> L[대체 방안 제시]
    L --> H
    
    H --> M[에러 로그 기록]
    M --> N[세션 상태 저장]
    
    style A fill:#ffccbc
    style J fill:#c8e6c9
    style K fill:#ff8a80
```

---

## 4. 사용자 여정 매핑

### 4.1 CEO의 일일 사용 시나리오

```mermaid
graph LR
    A[오전 9시: 로그인] --> B[대시보드 확인]
    B --> C[전날 주요 지표 리뷰]
    C --> D[CFO에게 재무 현황 질의]
    
    D --> E[오전 11시: 마케팅 회의 준비]
    E --> F[CMO에게 캠페인 성과 질의]
    
    F --> G[오후 2시: 기술 검토]
    G --> H[CTO에게 개발 진행 상황 질의]
    
    H --> I[오후 4시: 운영 점검]
    I --> J[COO에게 프로세스 효율성 질의]
    
    J --> K[오후 5시: 인사 이슈 확인]
    K --> L[CHRO에게 채용 현황 질의]
    
    L --> M[오후 6시: 일일 보고서 생성]
    M --> N[보고서 검토 및 저장]
    N --> O[로그아웃]
    
    style A fill:#e1f5ff
    style O fill:#ffcdd2
```

---

## 5. 플로우 연결 매트릭스

| 플로우 | PRD 사용자 스토리 | TRD 컴포넌트 | Database 엔티티 |
|--------|-------------------|--------------|-----------------|
| 메인 플로우 | US-1, US-2, US-3 | Query Analysis Engine, Agent Orchestration | Users, Conversations, Messages |
| 질의 분석 및 라우팅 | US-1 | Query Analysis Engine | Messages, Agents |
| 멀티 에이전트 협업 | US-2 | Agent Orchestration Layer | Conversations, Agent_Collaborations |
| 보고서 생성 | US-3 | Report Generator | Reports, Report_Templates |
| 실시간 알림 | US-4 | Notification Service | Notifications, Alert_Rules |
| 컨텍스트 유지 | US-5 | Context Manager | Conversations, Context_Store |

---

## 6. 성공 지표와 플로우 연결

| 플로우 단계 | 측정 지표 | 목표값 |
|-------------|-----------|--------|
| 질의 입력 → 분석 완료 | 분석 시간 | < 1초 |
| 에이전트 호출 → 응답 생성 | 응답 시간 | < 3초 (단일), < 8초 (멀티) |
| 보고서 생성 요청 → 완료 | 생성 시간 | < 10초 |
| 에러 발생 → 복구 | 복구 성공률 | > 95% |
| 대화 세션 전체 | 사용자 만족도 | > 4.5/5.0 |

---

**문서 버전 관리**  
- v1.0 (2026-01-10): 초기 작성, 5개 핵심 플로우 정의
- 다음 업데이트: 사용자 피드백 반영 및 실제 사용 패턴 분석 후 최적화